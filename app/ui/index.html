<!DOCTYPE html>
<html>
<head>
  <title>NG12 Cancer Risk Assessor</title>
  <style>
    body { font-family: Arial; margin: 40px; }
    textarea { width: 100%; height: 120px; }
    pre { background: #f4f4f4; padding: 10px; }
    #queryResult { height: 400px; overflow-y: auto; }
    button { margin-top: 10px; }
  </style>
</head>

<body>
<h2>NG12 Cancer Risk Assessor</h2>

<!-- MODULE 1 -->
<h3>Module 1: Patient Risk Assessment</h3>
<input id="patientId" placeholder="Enter Patient ID (e.g. PT-101)" />
<button onclick="assess()">Assess</button>

<pre id="assessmentResult"></pre>

<hr/>

<!-- MODULE 2 -->
<h3>Module 2: NICE NG12 Guideline Query</h3>
<textarea id="query" placeholder="Ask a question about NG12 guidelines..."></textarea>
<button onclick="search()">Search Guidelines</button>

<pre id="queryResult"></pre>

<script>
// Generate session ID once on page load
const sessionId = `session-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

async function assess() {
  const patientId = document.getElementById("patientId").value;
  document.getElementById("assessmentResult").innerText =
    "assessing...";
  const res = await fetch("/assess", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ patient_id: patientId, user_id: "user-123"})
  });

  document.getElementById("assessmentResult").innerText =
    JSON.stringify(await res.json(), null, 2);
}

async function search() {
  const query = document.getElementById("query").value;
   document.getElementById("queryResult").innerText ="querying...";

  const res = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: query, user_id: "user-123", session_id: sessionId })
  });

  const data = await res.json();
  document.getElementById("queryResult").innerText = data.content || "";
}
</script>
</body>
</html>
